<?xml version="1.0" encoding="ISO-8859-1"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:output method="text" encoding="UTF-8" indent="no"/><xsl:template match="/"><xsl:apply-templates/></xsl:template><xsl:template match="ROW"><xsl:if test="string-length(id1) &gt; 0"><xsl:variable name="sep" select="'£$;£$'"/><xsl:variable name="del" select="'£$'"/><xsl:variable name="id" select="id1"/><xsl:variable name="sbn"><xsl:choose><xsl:when test="//ROW[id6 = $id]/id6 >0"><xsl:value-of select="'si'"/></xsl:when><xsl:otherwise>no</xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="link" select="concat('http://anagrafe.iccu.sbn.it/iccu/abi?Action=ActionSearchesISIL&amp;Method=SearchesISIL&amp;SessionId=-1&amp;ABLITA=false&amp;ISIL_ST=IT&amp;ISIL_PR=',isil_pr,'&amp;ISIL_NR=',isil_nr)"/><xsl:variable name="tel"><xsl:choose><xsl:when test="//ROW[id3 = $id]/tipo_fax_tel = 'T'"><xsl:value-of select="//ROW[id3 = $id]/numero_fax_tel"/></xsl:when><xsl:otherwise></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="fax"><xsl:choose><xsl:when test="//ROW[id3 = $id]/tipo_fax_tel = 'F'"><xsl:value-of select="//ROW[id3 = $id]/numero_fax_tel"/></xsl:when><xsl:otherwise></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="url"><xsl:choose><xsl:when test="//ROW[id2 = $id]/tipo_email_url = 'U'"><xsl:value-of select="//ROW[id2 = $id]/valore_email_url"/></xsl:when><xsl:otherwise></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="email"><xsl:choose><xsl:when test="//ROW[id2 = $id]/tipo_email_url = 'E'"><xsl:value-of select="//ROW[id2 = $id]/valore_email_url"/></xsl:when><xsl:otherwise></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="descrizione"><xsl:if test="string-length(//ROW[id4 = $id]/gia) > 0"><xsl:value-of select="concat('già ',//ROW[id4 = $id]/gia)"/></xsl:if><xsl:if test="string-length(//ROW[id5 = $id]/anche) > 0"><xsl:value-of select="concat(' anche ',//ROW[id5 = $id]/anche)"/></xsl:if></xsl:variable><xsl:value-of select="$del"/><xsl:value-of select="isil_st"/>-<xsl:value-of select="isil_pr"/><xsl:value-of select="isil_nr"/><xsl:value-of select="$sep"/><xsl:value-of select="$sep"/><xsl:value-of select="$sep"/><xsl:value-of select="denominazione"/><xsl:value-of select="$sep"/><xsl:value-of select="$sep"/><xsl:value-of select="$descrizione"/><xsl:value-of select="$sep"/><xsl:value-of select="$sep"/><xsl:value-of select="indirizzo"/><xsl:value-of select="$sep"/><xsl:value-of select="$sep"/><xsl:value-of select="comune"/><xsl:value-of select="$sep"/><xsl:value-of select="cap"/><xsl:value-of select="$sep"/><xsl:value-of select="provincia"/><xsl:value-of select="$sep"/><xsl:value-of select="$tel"/><xsl:value-of select="$sep"/><xsl:value-of select="$fax"/><xsl:value-of select="$sep"/><xsl:value-of select="$email"/><xsl:value-of select="$sep"/><xsl:value-of select="$sep"/><xsl:value-of select="$link"/><xsl:value-of select="$sep"/><xsl:value-of select="$sep"/><xsl:value-of select="$url"/><xsl:value-of select="$sep"/><xsl:value-of select="$sep"/><xsl:value-of select="frazione"/><xsl:value-of select="$sep"/><xsl:value-of select="$sbn"/><xsl:value-of select="$del"/></xsl:if></xsl:template>
</xsl:stylesheet>