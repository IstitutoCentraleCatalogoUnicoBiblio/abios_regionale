<dataConfig>
  <dataSource type="JdbcDataSource" 
              driver="com.mysql.jdbc.Driver"
              url="jdbc:mysql://localhost/abipuglia?zeroDateTimeBehavior=convertToNull" 
              user="abi" 
              password="abi"/>
  <document>
    <entity name="biblioteca" pk="id_biblioteca" 
    		query="select * from biblioteca where id_stato_biblioteca_workflow != 4 "
    		deltaQuery="select b.* from biblioteca as b 
    					where b.id_stato_biblioteca_workflow = 1 and 
    						(b.catalogazione_data_modifica > SUBTIME('${dataimporter.last_index_time}','0:10:0') OR 0)"
    		deletedPkQuery="select * from biblioteca where id_stato_biblioteca_workflow = 4"
    		> <!-- seleziono solo le definitive -->
    
    		<field column="id_biblioteca" name="id_biblioteca"/>
    		<field column="id_biblioteca" name="id_bib_copy"/>
    		<field column="denominazione_ufficiale" name = "denominazione_ufficiale" />     
            <field column="denominazione_ufficiale" name = "denominazione_forsearch" />
    		
    		<entity name="stato_biblioteca_workflow"
    				query="select sbw.label from stato_biblioteca_workflow as sbw
    				where '${biblioteca.id_stato_biblioteca_workflow}'=sbw.id_stato">
    				
    				<field column="label" name="stato_biblioteca_workflow" />
    		</entity>
    		
    		<entity name="acnp"
    				query="select c.valore from codici c, codici_tipo ct 
    				where c.id_biblioteca='${biblioteca.id_biblioteca}' and 
    				c.id_codici=ct.id_codici and ct.descrizione='acnp'">
    				
    				<field column="valore" name="acnp" />
    		</entity>
    		
    		<entity name="cei"
    				query="select c.valore from codici c, codici_tipo ct 
    				where c.id_biblioteca='${biblioteca.id_biblioteca}' and 
    				c.id_codici=ct.id_codici and ct.descrizione='cei'">
    				
    				<field column="valore" name="cei" />
    		</entity>
    		
    		<entity name="cmbs"
    				query="select c.valore from codici c, codici_tipo ct 
    				where c.id_biblioteca='${biblioteca.id_biblioteca}' and 
    				c.id_codici=ct.id_codici and ct.descrizione='cmbs'">
    				
    				<field column="valore" name="cmbs" />
    		</entity>
    		
    		<entity name="rism"
    				query="select c.valore from codici c, codici_tipo ct 
    				where c.id_biblioteca='${biblioteca.id_biblioteca}' and 
    				c.id_codici=ct.id_codici and ct.descrizione='rism'">
    				
    				<field column="valore" name="rism" />
    		</entity>
    		
    		<entity name="sbn"
    				query="select c.valore from codici c, codici_tipo ct 
    				where c.id_biblioteca='${biblioteca.id_biblioteca}' and 
    				c.id_codici=ct.id_codici and ct.descrizione='sbn'">
    				
    				<field column="valore" name="sbn" />
    		</entity>
    		
    		<!-- PRESTITO LOCALE -->
			<entity name="prestito_locale"
    				query="select IF(b.id_biblioteca=prl.id_biblioteca, 'Si', 'No') as prestito_locale 
    				from biblioteca as b left join prestito_locale as prl 
    				on b.id_biblioteca=prl.id_biblioteca where b.id_biblioteca='${biblioteca.id_biblioteca}'">
    				
    				
    				<field column="prestito_locale" name="prestito_locale" />
    		</entity>
			
			<entity name="prestito_locale_display"
    				query="select concat('disponibile:', IF(b.id_biblioteca=prl.id_biblioteca, 'Si', 'No'), ',procedure:', IF(prl.automatizzato is not null and prl.automatizzato, 'Si', IF(prl.automatizzato is not null and !prl.automatizzato, 'No', '')))
    				as prestito_locale 
    				from biblioteca as b left join prestito_locale as prl 
    				on b.id_biblioteca=prl.id_biblioteca where b.id_biblioteca='${biblioteca.id_biblioteca}'">
    				
    				
    				<field column="prestito_locale" name="prestito_locale_display" />
    		</entity>    		

    		
    		<entity name="prestito_locale_materiale_escluso"
    				query="select pme.descrizione from prestito_locale_materiale_escluso as pme, 
    				prestito_locale_has_materiale_escluso phme, prestito_locale as p
    				where '${biblioteca.id_biblioteca}'=p.id_biblioteca and 
    				pme.id_prestito_locale_materiale_escluso=phme.id_prestito_locale_materiale_escluso and
    				phme.id_prestito_locale=p.id_prestito_locale">
    				
    				<field column="descrizione" name="materiale_escluso" />
    		</entity>
    		
    		<entity name="prestito_locale_utenti_ammessi"
    				query="select put.descrizione from prestito_locale_utenti_ammessi as put, 
    				prestito_locale_has_utenti_ammessi phut, prestito_locale as p
    				where '${biblioteca.id_biblioteca}'=p.id_biblioteca and 
    				put.id_prestito_locale_utenti_ammessi=phut.id_prestito_locale_utenti_ammessi and
    				phut.id_prestito_locale=p.id_prestito_locale">
    				
    				<field column="descrizione" name="utenti_ammessi" />
    		</entity>
    		<!-- FINE PRESTITO LOCALE -->
    		
    		<entity name="pubblicazioni"
    				query="select p.descrizione from pubblicazioni as p
    				where '${biblioteca.id_biblioteca}'=p.id_biblioteca">
    		
    				<field column="descrizione" name="pubblicazioni" />
    		</entity>
    		
    		<entity name="regolamento"
    				query="select concat(IF(r.riferimento_normativa is null,'',concat(r.riferimento_normativa, '$$$')), IF(r.url is null, '', IF(r.riferimento_normativa is null, concat('$$$', r.url), r.url))) as reg
    				from regolamento as r
    				where '${biblioteca.id_biblioteca}'=r.id_biblioteca">
    			
    				<field column="reg" name="regolamento" />
    		</entity>
    		   			  
   			<entity name="gestisce_servizio_bibliografico_interno"
   					query="select IF(gestisce_servizio_bibliografico_interno=true,
   					'Si', 'No') 
   					as inf_bibl_utenti_in_sede from biblioteca as b where b.id_biblioteca='${biblioteca.id_biblioteca}'">
   					
   					<field column="inf_bibl_utenti_in_sede" name="gestisce_servizio_bibliografico_interno" />
   			</entity>		
  
  			<entity name="gestisce_servizio_bibliografico_esterno"
   					query="select IF(gestisce_servizio_bibliografico_esterno=true,
   					'Si', 'No') 
   					as inf_bibl_utenti_esterni from biblioteca as b where b.id_biblioteca='${biblioteca.id_biblioteca}'">
   					
   					<field column="inf_bibl_utenti_esterni" name="gestisce_servizio_bibliografico_esterno" />
   			</entity>	
   			
   			
		<entity name="riproduzioni"
    				query="select distinct b.id_biblioteca, IF(b.id_biblioteca=ripr.id_biblioteca, 'Si', 'No')
    				as riproduzioni 
    				from biblioteca as b left join riproduzioni as ripr 
    				on b.id_biblioteca=ripr.id_biblioteca where b.id_biblioteca='${biblioteca.id_biblioteca}'">
    				
    				<field column="riproduzioni" name="riproduzioni" />
    		</entity>
    		
    		<entity name="info_riproduzioni"
    				query="select concat('modo:', IF(rt.descrizione is not null, rt.descrizione, ''), ',', 'locale:', IF(r.locale is null, '', IF(r.locale, 'Si', 'No')), ',', 'nazionale:', IF(r.nazionale is null, '', IF(r.nazionale, 'Si', 'No')), ',', 'internazionale:', IF(r.internazionale is null, '', IF(r.internazionale, 'Si', 'No'))) as info
    				from riproduzioni as r, riproduzioni_tipo as rt
    				where '${biblioteca.id_biblioteca}'=r.id_biblioteca and 
    				rt.id_riproduzioni_tipo=r.id_riproduzioni_tipo order by rt.descrizione ASC">
    				
    				<field column="info" name="info_riproduzioni" />
    		</entity>


    		
    		<entity name="postazioni_internet"
    				query="select IF(b.posti_internet is not null AND b.posti_internet &gt; 0, 'Si', 'No') 
    				as postazioni_internet from biblioteca as b where b.id_biblioteca='${biblioteca.id_biblioteca}'"> 
    				
    				<field column="postazioni_internet" name="postazioni_internet" />
    		</entity>
    		
    		<entity name="ente_denominazione"
    		 		query="select IF(e.denominazione is not null and CHAR_LENGTH(e.denominazione)!=0, e.denominazione, '')
    		 		as ente_denominazione 
    		 		from ente as e 
    		 		where '${biblioteca.id_ente}'=e.id_ente">
    		 		
    		 		<field column="ente_denominazione" name="ente_denominazione" />
    		</entity>
    		
    		<entity name="tipologia_amministrativa"
    				query="select ta.id_ente_tipologia_amministrativa, ta.descrizione 
    				from ente_tipologia_amministrativa as ta, ente as e
    				where e.id_ente='${biblioteca.id_ente}' 
    				and ta.id_ente_tipologia_amministrativa=e.id_ente_tipologia_amministrativa">
    				
    				<field column="id_ente_tipologia_amministrativa" name="id_tipologia_amministrativa" />
    				<field column="descrizione" name="tipologia_amministrativa" />
    		</entity>
    		
    		<entity name="ente_obiettivo"
    				query="select o.descrizione from ente_obiettivo as o, ente as e
    				where e.id_ente='${biblioteca.id_ente}' and
    				o.id_ente_obiettivo=e.id_ente_obiettivo">
    				
    				<field column="descrizione" name="obiettivo" />		
    		</entity>
    		
    		<entity name="fondi_digitali"
    				query="select f.descrizione from fondi_digitali as f
    				where '${biblioteca.id_biblioteca}'=f.id_biblioteca">
    				
    				<field column="descrizione" name="fondi_digitali" />		
    		</entity>  
    		 		
    		<entity name="fondi_speciali"
    				query="select concat(f.denominazione,':', fci.descrizione) as fondi from fondi_speciali as f, 
    				biblioteca_has_fondi_speciali as bf, fondi_speciali_catalogazione_inventario as fci
    				where '${biblioteca.id_biblioteca}'=bf.id_biblioteca and 
    				bf.id_fondi_speciali=f.id_fondi_speciali and
    				f.id_fondi_speciali_catalogazione_inventario=fci.id_fondi_speciali_catalogazione_inventario">
    				
    				<field column="fondi" name="fondi_speciali" />
      		</entity> 
    		
    		<entity name="latitudine"
    				query="select IF(g.latitudine is null, 0.0, g.latitudine) as latitudine from geolocalizzazione as g
    				where '${biblioteca.id_biblioteca}'=g.id_biblioteca">
    				
    				<field column="latitudine" name="latitudine" />
    		</entity>
    		
    		<entity name="longitudine"
    				query="select IF(g.longitudine is null, 0.0, g.longitudine) as longitudine from geolocalizzazione as g
    				where '${biblioteca.id_biblioteca}'=g.id_biblioteca">
    				
    				<field column="longitudine" name="longitudine" />
    		</entity>
    		
    		<entity name="tipologia_funzionale"
    				query="select tf.descrizione from tipologia_funzionale as tf
    				where '${biblioteca.id_tipologia_funzionale}'=tf.id_tipologia_funzionale">
    				
    				<field column="descrizione" name="tipologia_funzionale" />
    		</entity>
    		
    		<entity name="dewey"
    				query="select IF(length(dew.id_dewey) > 3, concat(substring(dew.id_dewey,1,3),'.',substring(dew.id_dewey,4,6)), dew.id_dewey) as id_dewey, dew.descrizione from dewey as dew, biblioteca_has_dewey as bib_dew
    				where bib_dew.id_biblioteca='${biblioteca.id_biblioteca}' and 
    				dew.id_dewey=bib_dew.id_dewey">
    				
    				<field column="id_dewey" name="codice_dewey" />
    				<field column="descrizione" name="descrizione_ufficiale" />
    				<field column="descrizione" name="descrizione_ufficiale_esatta" />
    		</entity>
    		
    		<entity name="dewey_display"
    				query="select distinct concat(f.id_dewey, '$$$', d.descrizione) as descr from fondi_speciali as f, biblioteca_has_fondi_speciali as bh, dewey as d
    				where bh.id_biblioteca='${biblioteca.id_biblioteca}' and bh.id_fondi_speciali=f.id_fondi_speciali and 
    				f.id_dewey=d.id_dewey">
    				
    				<field column="descr" name="dewey_display" />
    		</entity>	
    		
    		<entity name="descrizione_libera_dewey"
    				query="select dew_lib.descrizione from dewey_libero as dew_lib
    				where dew_lib.id_biblioteca='${biblioteca.id_biblioteca}'">    				
    				
    				<field column="descrizione" name="descrizione_libera" />
    		</entity>
    		
    		<entity name="dewey_libero"
    				query="select concat(dl.id_dewey, '$$$', d.descrizione, ';', IF(dl.descrizione is null, '', dl.descrizione)) as descr from dewey as d, dewey_libero as dl
    				where dl.id_biblioteca='${biblioteca.id_biblioteca}' and dl.id_dewey=d.id_dewey">
    				
    				<field column="descr" name="dewey_libero_display" />
    		</entity>
    		
    		<entity name="sistemi_biblioteche"
    				query="select sb.descrizione from sistemi_biblioteche as sb, biblioteca_has_sistemi_biblioteche as bsb
    				where bsb.id_biblioteca='${biblioteca.id_biblioteca}' and sb.id_sistemi_biblioteche=bsb.id_sistemi_biblioteche">
    		
    				<field column="descrizione" name="sistemi_biblioteche" />
    		</entity> 		

			<entity name="sezioni_speciali"
    				query="select ss.descrizione from sezioni_speciali as ss, biblioteca_has_sezioni_speciali as bss
    				where bss.id_biblioteca='${biblioteca.id_biblioteca}' and ss.id_sezioni_speciali=bss.id_sezioni_speciali">
    				
    				<field column="descrizione" name="sezioni_speciali" />
    		</entity>  
		   		
    		<entity name="denominazioni_alternative"
    				query="select da.denominazione from denominazioni_alternative as da
    				where '${biblioteca.id_biblioteca}'=da.id_biblioteca">
    				
    				<field column="denominazione" name="denominazioni_alternative" />
    				<field column="denominazione" name = "denominazione_forsearch" />
    		</entity>
    		
    		<entity name="denominazioni_precedenti"
    				query="select dp.denominazione from denominazioni_precedenti as dp
    				where '${biblioteca.id_biblioteca}'=dp.id_biblioteca">
    				
    				<field column="denominazione" name="denominazioni_precedenti" />
    				<field column="denominazione" name = "denominazione_forsearch" />
    		</entity>
    		
    		<entity name="comunicazioni"
    				query="select c.descrizione from comunicazioni as c
    				where '${biblioteca.id_biblioteca}'=c.id_biblioteca">
    				
    				<field column="descrizione" name="comunicazioni" />
    		</entity>
    		
    		<entity name="dati_regioni_istat"
    				query="select dr.totale_abitanti from dati_regioni_istat as dr, regione as r, provincia as p, comune as c
    				where '${biblioteca.id_comune}'=c.id_comune and c.id_provincia=p.id_provincia
    				and p.id_regione=r.id_regione and dr.id_regione=r.id_regione">
    				
    				<field column="totale_abitanti" name="totale_abitanti_regioni" />
    		</entity>
    		
    		<entity name="dati_province_istat"
    				query="select dp.totale_abitanti from dati_province_istat as dp, provincia as p, comune as c
    				where '${biblioteca.id_comune}'=c.id_comune and c.id_provincia=p.id_provincia 
    				and dp.id_provincia=p.id_provincia">
    				
    				<field column="totale_abitanti" name="totale_abitanti_province" />
    		</entity>
    		
    		<entity name="stato"
    				query="select s.denominazione from stato as s, regione as r, 
    				provincia as p, comune as c
    				where '${biblioteca.id_comune}'=c.id_comune and c.id_provincia=p.id_provincia
    				and p.id_regione=r.id_regione and r.id_stato=s.id_stato">
    				
    				<field column="denominazione" name="stato" />
    		</entity>
    		<entity name="regione"
    				query="select r.id_regione, r.denominazione from regione as r, 
    				provincia as p, comune as c
    				where '${biblioteca.id_comune}' = c.id_comune AND
    				c.id_provincia = p.id_provincia AND p.id_regione = r.id_regione">
    				
    				<field column="id_regione" name="id_regione" />
    				<field column="denominazione" name="regione" />
    		</entity>
    		
    		<entity name="provincia"
    				query="select p.id_provincia, p.denominazione, p.sigla from provincia as p, comune as c
    				where '${biblioteca.id_comune}' = c.id_comune AND
    				c.id_provincia = p.id_provincia">
    				
    				<field column="id_provincia" name="id_provincia" />
    				<field column="denominazione" name="provincia" />
    				<field column="sigla" name="provincia_sigla" />
    		</entity>
    		
    		<entity name="comune"
    				query="select com.id_comune, com.denominazione, concat(com.denominazione, '$$$', convert(com.id_comune using utf8)) as comune_record from comune as com
    				where '${biblioteca.id_comune}' = com.id_comune">
    				<field column="id_comune" name="id_comune" />
    				<field column="denominazione" name="comune" />
    				<field column="comune_record" name="comune_record" />
    		</entity> 
    		
    		
    		<!-- PATRIMONIO -->    
    		<entity name="patrimonio_librario_display"
    				query="SELECT IF(p.id_patrimonio_specializzazione_categoria_madre is null, 
    				concat(p.descrizione, ';$$$', ps.descrizione,';',CONVERT(patr.quantita using utf8)),
    				concat((SELECT distinct p2.descrizione as descr FROM patrimonio_specializzazione_categoria p1, patrimonio_specializzazione_categoria p2 where p1.id_patrimonio_specializzazione_categoria_madre=p2.id_patrimonio_specializzazione_categoria and p2.id_patrimonio_specializzazione_categoria = p.id_patrimonio_specializzazione_categoria_madre),';',p.descrizione, '$$$', ps.descrizione, ';', CONVERT(patr.quantita using utf8))) as descr 
    				FROM patrimonio_specializzazione_categoria p, patrimonio_specializzazione ps, patrimonio as patr where ps.id_patrimonio_specializzazione_categoria=p.id_patrimonio_specializzazione_categoria and patr.id_patrimonio_specializzazione=ps.id_patrimonio_specializzazione and patr.id_biblioteca='${biblioteca.id_biblioteca}' order by p.descrizione ASC">
    				
    				<field column="descr" name="patrimonio_librario_display" />
    		</entity>

			<entity name="patrimonio_librario_tipologia"
    				query="select distinct IF(p.id_patrimonio_specializzazione_categoria_madre is null, 
    				concat(p.descrizione, ';'), 
    				concat((SELECT distinct p2.descrizione as descr FROM patrimonio_specializzazione_categoria p1, patrimonio_specializzazione_categoria p2 where p1.id_patrimonio_specializzazione_categoria_madre=p2.id_patrimonio_specializzazione_categoria and p2.id_patrimonio_specializzazione_categoria = p.id_patrimonio_specializzazione_categoria_madre),';',p.descrizione)) as descr 
    				from patrimonio_specializzazione_categoria p, patrimonio_specializzazione ps, patrimonio as patr 
    				where ps.id_patrimonio_specializzazione_categoria=p.id_patrimonio_specializzazione_categoria and 
    				patr.id_patrimonio_specializzazione=ps.id_patrimonio_specializzazione and 
    				patr.id_biblioteca='${biblioteca.id_biblioteca}' order by descr ASC">
    		
					<field column="descr" name="patrimonio_librario_tipologia" />	
    		</entity>
    		
    		<entity name="patrimonio_cat_descr"
   					query="select distinct pc.descrizione
   					from patrimonio_specializzazione_categoria as pc, patrimonio_specializzazione as ps, 
   					patrimonio as p
   					where '${biblioteca.id_biblioteca}'=p.id_biblioteca and 
   					p.id_patrimonio_specializzazione=ps.id_patrimonio_specializzazione and
   					ps.id_patrimonio_specializzazione_categoria=pc.id_patrimonio_specializzazione_categoria
   					order by pc.descrizione asc">
   					
   					<field column="descrizione" name="patrimonio_librario_descr" />
   			</entity>
   			
   			<entity name="patrimonio_spec_descr"
   					query="select ps.descrizione
   					from patrimonio_specializzazione as ps, patrimonio as p
   					where '${biblioteca.id_biblioteca}'=p.id_biblioteca and 
   					p.id_patrimonio_specializzazione=ps.id_patrimonio_specializzazione">
   					
   					<field column="descrizione" name="patrimonio_librario_descr" />
   			</entity>
    		

    		<!-- FINE PATRIMONIO -->
    		
    		
    		<!-- PRESTITO -->  		
    		<entity name="sistemi_prestito_interbibliotecario"
    				query="select s.descrizione from sistemi_prestito_interbibliotecario as s, 
    				biblioteca_has_sistemi_prestito_interbibliotecario as bs
    				where '${biblioteca.id_biblioteca}'=bs.id_biblioteca and 
    				bs.id_sistemi_prestito_interbibliotecario=s.id_sistemi_prestito_interbibliotecario
    				order by s.descrizione ASC">
    				
    				<field column="descrizione" name="sistemi_prestito_interbibliotecario" />
    		</entity>
    		   
    		  
    		  <entity name="prestito_interbibliotecario"
    				query="select concat('ruolo:', m.descrizione, ',', 'nazionale:', IF(pi.nazionale, 'Si', 'No'), ',', 'internazionale:', IF(pi.internazionale, 'Si', 'No')) as pres
    				from prestito_interbibliotecario as pi, biblioteca_has_prestito_interbibliotecario as bpi,
    				prestito_interbibliotecario_modo as m
    				where '${biblioteca.id_biblioteca}'=bpi.id_biblioteca and 
    				bpi.id_prestito_interbibliotecario=pi.id_prestito_interbibliotecario and
    				pi.id_prestito_interbibliotecario_modo=m.id_prestito_interbibliotecario_modo
    				order by m.descrizione ASC">
    				
    				<field column="pres" name="prestito_interbibliotecario_display" />
    		</entity>  
    		
    		<!-- FINE PRESTITO -->
    		
    		<entity name="bibliografia"
      				query="select bgrf.descrizione from bibliografia as bgrf
      				where bgrf.id_biblioteca ='${biblioteca.id_biblioteca}'">
     		
  					<field column="descrizione" name="bibliografia" />
   			</entity>   
   			
   			<entity name="stato_catalogazione"
   					query="select sct.descrizione from stato_catalogazione_tipo as sct, 
   					stato_catalogazione sc
   					where sc.id_biblioteca = '${biblioteca.id_biblioteca}' AND
   					sct.id_stato_catalogazione_tipo = sc.id_stato_catalogazione">
   					
   					<field column="descrizione" name="stato_catalogazione" />
   			</entity>
   			
   			<entity name="destinazioni_sociali"
   					query="select dst.descrizione, concat(dst.descrizione, '$$$', IF(ds.note is not null, ds.note, '')) as descr from destinazioni_sociali_tipo as dst, 
   					destinazioni_sociali as ds
   					where ds.id_biblioteca = '${biblioteca.id_biblioteca}' AND
   					dst.id_destinazioni_sociali = ds.id_destinazioni_sociali_tipo order by descr ASC">
   					
   					<field column="descrizione" name="destinazioni_sociali" />
   					<field column="descr" name="destinazioni_sociali_display" />
   			</entity>
   			
   			
   			<!-- FONDI SPECIALI -->
   			<entity name="fondi_speciali_display"
   					query="select concat(IF(fs.denominazione is null or CHAR_LENGTH(fs.denominazione)=0, '', fs.denominazione), '$$$', IF(fs.descrizione is null or CHAR_LENGTH(fs.descrizione)=0, '', fs.descrizione), ';', IF(fs.fondo_depositato is null, '', IF(fs.fondo_depositato, 'Si', 'No')), '$$$', fsc.descrizione, ';', IF(fs.id_fondi_speciali_catalogazione_inventario = 3 and fs.catalogazione_inventario_url is not null,fs.catalogazione_inventario_url,''), '$$$', IF(fs.id_dewey is null, '', fs.id_dewey)) as fs_display 
   					from fondi_speciali as fs, biblioteca_has_fondi_speciali as bfs, fondi_speciali_catalogazione_inventario as fsc
   					where bfs.id_biblioteca='${biblioteca.id_biblioteca}'
   					and fs.id_fondi_speciali=bfs.id_fondi_speciali and fs.id_fondi_speciali_catalogazione_inventario=fsc.id_fondi_speciali_catalogazione_inventario
   					order by fs.denominazione ASC">
   					
   					<field column="fs_display" name="fondi_speciali_display" />
   			</entity>
   			
   			
   			<entity name="fondi_speciali_info"
   					query="select f.descrizione, f.denominazione
   					from fondi_speciali as f, biblioteca_has_fondi_speciali as bf
   					where bf.id_biblioteca='${biblioteca.id_biblioteca}' and
   					f.id_fondi_speciali=bf.id_fondi_speciali">
   					
   					<field column="descrizione" name="fondi_speciali_descrizione" />
   					<field column="denominazione" name="fondi_speciali_denominazione" />
   			</entity>
   					
   			<!-- FINE FONDI SPECIALI -->		
   			
   			
   			<entity name="denominazione_fondo"
   					query="select fs.denominazione from fondi_speciali as fs, biblioteca_has_fondi_speciali as bfs
   					where bfs.id_biblioteca='${biblioteca.id_biblioteca}' 
   					and fs.id_fondi_speciali=bfs.id_fondi_speciali">
   					
   					<field column="denominazione" name="denominazione_fondo" />
   			</entity>
   			
   			<entity name="descrizione_fondo"
   					query="select fs.descrizione from fondi_speciali as fs, biblioteca_has_fondi_speciali as bfs
   					where bfs.id_biblioteca='${biblioteca.id_biblioteca}' 
   					and fs.id_fondi_speciali=bfs.id_fondi_speciali">
   					
   					<field column="descrizione" name="descrizione_fondo" />
   			</entity>
   			
   			<entity name="spogli_bibliografici"
   					query="select sp.descrizione_bibliografica from spogli_bibliografici as sp
   					where sp.id_biblioteca='${biblioteca.id_biblioteca}'">
   					
   					<field column="descrizione_bibliografica" name="spogli_bibliografici" />
   			</entity>
   			
   			<!-- ORARIO UFFICIALE -->
   			<entity name="orario_ufficiale"
   					query="select concat(q1.day, q1.ora) as orario 
   					from (select concat(IF(o.giorno=1, 'Lunedi$$$', IF(o.giorno=2, 'Martedi$$$', 
   					IF(o.giorno=3, 'Mercoledi$$$', IF(o.giorno=4, 'Giovedi$$$', 
   					IF(o.giorno=5, 'Venerdi$$$', IF(o.giorno=6, 'Sabato$$$', 'Domenica$$$'))))))) as day, 
   					CONVERT(GROUP_CONCAT(concat(SUBSTRING(TIME(o.dalle),1,5), ' / ', SUBSTRING(TIME(o.alle),1,5)) separator '-') USING utf8) as ora
   					from orario_ufficiali as o where o.id_biblioteca='${biblioteca.id_biblioteca}' group by o.id_biblioteca, o.giorno, o.dalle) as q1">
   			
   					<field column="orario" name="orario_ufficiale" />
   			</entity>
   			
   			<!-- ORARIO CHIUSURE -->
   			<entity name="orario_chiusura"
   					query="select o.descrizione from orario_chiusure as o
   					where '${biblioteca.id_biblioteca}'=o.id_biblioteca">
   					
   					<field column="descrizione" name="orario_chiusura" />
   			</entity>
   			
   			<!-- ORARIO VARIAZIONI -->
   			<entity name="orario_variazioni_periodo"
   					query="select distinct o.id_biblioteca, o.descrizione 
   					from orario_variazioni as o 
   					where o.id_biblioteca='${biblioteca.id_biblioteca}'">
   					
   					<field column="descrizione" name="orario_variazioni_periodo" />			
   			</entity>
   			
   			<entity name="orario_variazioni"
   					query="SELECT  concat(q1.day, q1.ora) as orario 
   					FROM (select concat(IF(o.giorno is null, null, 
   					IF(o.giorno=1, 'Lunedi$$$', IF(o.giorno=2, 'Martedi$$$', 
   					IF(o.giorno=3, 'Mercoledi$$$', IF(o.giorno=4, 'Giovedi$$$', 
   					IF(o.giorno=5, 'Venerdi$$$', IF(o.giorno=6, 'Sabato$$$', 'Domenica$$$')))))))) as day, 
   					CONVERT(GROUP_CONCAT(concat(SUBSTRING(TIME(o.dalle),1,5), ' / ', SUBSTRING(TIME(o.alle),1,5)) separator '-') USING utf8) 
   					as ora from orario_variazioni as o where o.id_biblioteca='${biblioteca.id_biblioteca}' group by o.id_biblioteca, o.giorno, o.dalle order by o.id_biblioteca, o.giorno, o.dalle ASC) as q1">
   					
   					<field column="orario" name="orario_variazioni" />
   			</entity>
   			
   			
   			<!-- ORARIO UFFICIALE FASCE -->
   			<entity name="orario_ufficiali_fasce"
   					query="select * from orario_ufficiali as o
   					where '${biblioteca.id_biblioteca}'= o.id_biblioteca"
   					transformer="it.inera.abi.solr.transformer.FasceTransformer">
   					
   					<field column="orario_ufficiale_fasce" name="orario_ufficiale_fasce" />
   			</entity>
   			
			<!-- CATALOGHI -->
   			<entity name="cataloghi_generali_display"
   					query="select concat('tipo_catalogo:',tip.descrizione, ',', 'schede:',IF(schede, IF(percentuale_schede is not null and percentuale_schede!=0, concat('Si$$$', convert(percentuale_schede using utf8)),'Si$$$'), 'No$$$'), ',', 'volume:',IF(volume, IF(percentuale_volume is not null and percentuale_volume!=0, concat('Si$$$', convert(percentuale_volume using utf8)),'Si$$$'), 'No$$$'), ',', 'microforme:', IF(microforme, IF(percentuale_microforme is not null and percentuale_microforme!=0, concat('Si$$$', convert(percentuale_microforme using utf8)),'Si$$$'), 'No$$$'), ',', 'supporto_digitale:', IF(csdt.descrizione='Online' and cgu.id_cataloghi_generali_url is not null, concat(csdt.descrizione, ',', cgu.id_cataloghi_generali_url), concat(csdt.descrizione, ',')),'$$$', IF(percentuale_informatizzata is not null and percentuale_informatizzata!=0, convert(percentuale_informatizzata using utf8), ''), ',da_anno:',IF(da_anno is not null and da_anno!=0, convert(da_anno using utf8), ''), ',a_anno:', IF(a_anno is not null and a_anno!=0, convert(a_anno using utf8), '')) as svm
   					from cataloghi_supporto_digitale_tipo as csdt,
   					catalogo_generale_tipo as tip, partecipa_cataloghi_generali as pcg left join cataloghi_generali_url as cgu on cgu.id_cataloghi_generali=pcg.id_cataloghi_generali where '${biblioteca.id_biblioteca}'=pcg.id_biblioteca and
   					pcg.id_cataloghi_supporto_digitale_tipo=csdt.id_cataloghi_supporto_digitale_tipo and
   					pcg.id_catalogo_generale_tipo=tip.id_catalogo_generale_tipo order by tip.descrizione ASC">
   					
   					<field column="svm" name="cataloghi_generali_display" />
   			</entity>
   			
   			<entity name="cataloghi_collettivi_display"
   					query="select concat('catalogo:', c.descrizione, ',zona:', cz.descrizione, ',dettaglio_zona:', IF(c.dettaglio_zona is not null, c.dettaglio_zona, ''), ',patrimonio:', patr.descrizione, ',schede:', IF(schede, IF(percentuale_schede is not null and percentuale_schede!=0, concat('Si$$$', convert(percentuale_schede using utf8)),'Si$$$'), 'No$$$'), ',', 'volume:',IF(volume, IF(percentuale_volume is not null and percentuale_volume!=0, concat('Si$$$', convert(percentuale_volume using utf8)),'Si$$$'), 'No$$$'), ',', 'microforme:',IF(microforme, IF(percentuale_microforme is not null and percentuale_microforme!=0, concat('Si$$$', convert(percentuale_microforme using utf8)),'Si$$$'), 'No$$$'), ',', 'supporto_digitale:', IF(dig.descrizione='Online' and ccmu.id_cataloghi_collettivi_materiale_url is not null, concat(dig.descrizione, ',', ccmu.id_cataloghi_collettivi_materiale_url), concat(dig.descrizione, ',')),'$$$', IF(percentuale_informatizzata is not null and percentuale_informatizzata!=0, convert(percentuale_informatizzata using utf8), ''),',citazione:',IF(pm.descrizione_volume is not null, pm.descrizione_volume, ''), ',da_anno:',IF(da_anno is not null and da_anno!=0, convert(da_anno using utf8), ''), ',a_anno:', IF(a_anno is not null and a_anno!=0, convert(a_anno using utf8), '')) as svm 
   					from cataloghi_collettivi as c, cataloghi_collettivi_zona_tipo as cz, 
   					patrimonio_specializzazione as patr, cataloghi_supporto_digitale_tipo as dig, 
   					partecipa_cataloghi_collettivi_materiale as pm left join cataloghi_collettivi_materiale_url as ccmu 
   					on pm.id_cataloghi_collettivi_materiale=ccmu.id_cataloghi_collettivi_materiale 
   					where '${biblioteca.id_biblioteca}'=pm.id_biblioteca and 
   					pm.id_cataloghi_collettivi=c.id_cataloghi_collettivi and
   					c.id_cataloghi_collettivi_zona_tipo=cz.id_cataloghi_collettivi_zona_tipo and
   					patr.id_patrimonio_specializzazione=pm.id_patrimonio_specializzazione  and dig.id_cataloghi_supporto_digitale_tipo=pm.id_cataloghi_supporto_digitale_tipo order by c.descrizione ASC">
   					
   					<field column="svm" name="cataloghi_collettivi_display" />
   			</entity>
   			
   			<entity name="cataloghi_speciali_display"
   					query="select concat('denominazione:', IF(pcsm.denominazione is not null, pcsm.denominazione, ''), ',tipi_materiali:',patr.descrizione, ',', 'schede:',IF(schede, IF(percentuale_schede is not null and percentuale_schede!=0, concat('Si$$$', convert(percentuale_schede using utf8)),'Si$$$'), 'No$$$'), ',', 'volume:',IF(volume, IF(percentuale_volume is not null and percentuale_volume!=0, concat('Si$$$', convert(percentuale_volume using utf8)),'Si$$$'), 'No$$$'), ',', 'microforme:',IF(microforme, IF(percentuale_microforme is not null and percentuale_microforme!=0, concat('Si$$$', convert(percentuale_microforme using utf8)),'Si$$$'), 'No$$$'), ',', 'supporto_digitale:', IF(csdt.descrizione='Online' and csmu.id_cataloghi_speciali_materiale_url is not null, concat(csdt.descrizione, ',', csmu.id_cataloghi_speciali_materiale_url), concat(csdt.descrizione, ',')),'$$$', IF(percentuale_informatizzata is not null and percentuale_informatizzata!=0, convert(percentuale_informatizzata using utf8), ''),',citazione:',IF(pcsm.descrizione_volume is not null, pcsm.descrizione_volume, ''), ',da_anno:',IF(da_anno is not null and da_anno!=0, convert(da_anno using utf8), ''), ',a_anno:', IF(a_anno is not null and a_anno!=0, convert(a_anno using utf8), '')) as svm
   					from cataloghi_supporto_digitale_tipo as csdt, patrimonio_specializzazione as patr, partecipa_cataloghi_speciali_materiale as pcsm left join cataloghi_speciali_materiale_url as csmu on pcsm.id_cataloghi_speciali_materiale=csmu.id_cataloghi_speciali_materiale
   					where '${biblioteca.id_biblioteca}'=pcsm.id_biblioteca and
   					pcsm.id_cataloghi_supporto_digitale_tipo=csdt.id_cataloghi_supporto_digitale_tipo and
   					pcsm.id_patrimonio_specializzazione=patr.id_patrimonio_specializzazione 
   					order by patr.descrizione ASC">
   					
   					<field column="svm" name="cataloghi_speciali_display" />
   			</entity>
   			
   			   			
   			<entity name="cataloghi_collettivi_materiale_url"
   					query="select concat(convert(cc.id_cataloghi_collettivi_materiale_url using utf8), '$$$', cc.url) as url_descr from cataloghi_collettivi_materiale_url as cc,
   					partecipa_cataloghi_collettivi_materiale as pcc
   					where '${biblioteca.id_biblioteca}'=pcc.id_biblioteca and
   					pcc.id_cataloghi_collettivi_materiale=cc.id_cataloghi_collettivi_materiale">
   					
   					<field column="url_descr" name="cataloghi_collettivi_materiale_url" />
   			</entity>
   			
   			<entity name="cataloghi_speciali_materiale_url"
   					query="select concat(convert(cc.id_cataloghi_speciali_materiale_url using utf8),'$$$', cc.url) as url_descr 
   					from cataloghi_speciali_materiale_url as cc,
   					partecipa_cataloghi_speciali_materiale as pcc
   					where '${biblioteca.id_biblioteca}'=pcc.id_biblioteca and
   					pcc.id_cataloghi_speciali_materiale=cc.id_cataloghi_speciali_materiale">
   					
   					<field column="url_descr" name="cataloghi_speciali_materiale_url" />
   			</entity>
   			
   			<entity name="cataloghi_generali_url"
   					query="select concat(convert(cc.id_cataloghi_generali_url using utf8), '$$$', cc.url) as url_descr from cataloghi_generali_url as cc,
   					partecipa_cataloghi_generali as pcc
   					where '${biblioteca.id_biblioteca}'=pcc.id_biblioteca and
   					pcc.id_cataloghi_generali=cc.id_cataloghi_generali">
   					
   					<field column="url_descr" name="cataloghi_generali_url" />
   			</entity>
   			
   			<entity name="cataloghi_collettivi_partecipa"
   					query="SELECT distinct zt.descrizione
   					FROM partecipa_cataloghi_collettivi_materiale p, cataloghi_collettivi as c, cataloghi_collettivi_zona_tipo as zt
   					where '${biblioteca.id_biblioteca}'=p.id_biblioteca and p.id_cataloghi_collettivi=c.id_cataloghi_collettivi and c.id_cataloghi_collettivi_zona_tipo=zt.id_cataloghi_collettivi_zona_tipo
   					order by p.id_biblioteca, zt.descrizione ASC">
   			
   					<field column="descrizione" name="cataloghi_collettivi_partecipa"/>
   			</entity>
   			
   			<entity name="catalogo_generale_tipo"
   					query="select t.descrizione
   					from catalogo_generale_tipo t, partecipa_cataloghi_generali p
   					where p.id_biblioteca='${biblioteca.id_biblioteca}' and
   					p.id_catalogo_generale_tipo=t.id_catalogo_generale_tipo">
   					
   					<field column="descrizione" name="catalogo_generale_tipo" />
   			</entity>
   			
   			<entity name="partecipa_cataloghi_speciali_materiale_cat_descr"
   					query="select distinct pc.descrizione
   					from patrimonio_specializzazione_categoria as pc, patrimonio_specializzazione as ps, 
   					partecipa_cataloghi_speciali_materiale as cs
   					where '${biblioteca.id_biblioteca}'=cs.id_biblioteca and 
   					cs.id_patrimonio_specializzazione=ps.id_patrimonio_specializzazione and
   					ps.id_patrimonio_specializzazione_categoria=pc.id_patrimonio_specializzazione_categoria
   					order by pc.descrizione asc">
   					
   					<field column="descrizione" name="cataloghi_speciali_descr" />
   			</entity>
   			
   			<entity name="partecipa_cataloghi_speciali_materiale_spec_descr"
   					query="select ps.descrizione
   					from patrimonio_specializzazione as ps, partecipa_cataloghi_speciali_materiale as cs
   					where '${biblioteca.id_biblioteca}'=cs.id_biblioteca and 
   					cs.id_patrimonio_specializzazione=ps.id_patrimonio_specializzazione">
   					
   					<field column="descrizione" name="cataloghi_speciali_descr" />
   			</entity>
   			
   			<entity name="partecipa_cataloghi_collettivi_materiale_cat_descr"
   					query="SELECT cc.descrizione FROM partecipa_cataloghi_collettivi_materiale p 
   					join cataloghi_collettivi cc on p.id_cataloghi_collettivi = cc.id_cataloghi_collettivi 
   					where p.id_biblioteca = '${biblioteca.id_biblioteca}' order by p.id_biblioteca asc">
   					
   					<field column="descrizione" name="cataloghi_collettivi_descr" />
   			</entity>
   			
   			<!-- FINE CATALOGHI -->
   			
   			   			
   	  		<!-- BIBLIOTECA_HAS -->
    		<entity name="servizi_informazioni_bibliografiche_modalita"
      				query="select inf.descrizione from servizi_informazioni_bibliografiche_modalita as inf,
      				biblioteca_has_servizi_informazioni_bibliografiche binf
      				where binf.id_biblioteca ='${biblioteca.id_biblioteca}' AND
      				inf.id_servizi_informazioni_bibliografiche_modalita = binf.id_servizi_informazioni_bibliografiche_modalita 
      				order by inf.descrizione ASC">
      		
      				<field column="descrizione" name="servizi_informazioni_bibliografiche_modalita" />
   			</entity> 
   			
   			<entity name="thesaurus"
					query="select t.nome from thesaurus as t,
					biblioteca_has_thesaurus bt
					where bt.id_biblioteca ='${biblioteca.id_biblioteca}' AND
					t.id_thesaurus = bt.id_thesaurus">
					
					<field column="nome" name="thesaurus" />					
			</entity>
			
			<entity name="indicizzazione_classificata"
					query="select ic.descrizione from indicizzazione_classificata as ic,
					biblioteca_has_indicizzazione_classificata bic
					where bic.id_biblioteca ='${biblioteca.id_biblioteca}' AND
					ic.id_indicizzazione_classificata = bic.id_indicizzazione_classificata">
					
					<field column="descrizione" name="indicizzazione_classificata" />				
			</entity>
			
			<entity name="indicizzazione_soggetto"
					query="select isg.descrizione from indicizzazione_soggetto as isg,
					biblioteca_has_indicizzazione_soggetto bisg
					where bisg.id_biblioteca ='${biblioteca.id_biblioteca}' AND
					isg.id_indicizzazione_soggetto = bisg.id_indicizzazione_soggetto">
					
					<field column="descrizione" name="indicizzazione_soggetto" />				
			</entity>
			
			<entity name="norme_catalogazione"
   					query="select nc.descrizione from norme_catalogazione as nc, 
   					biblioteca_has_norme_catalogazione bnc
   					where bnc.id_biblioteca ='${biblioteca.id_biblioteca}' AND
   					nc.id_norme_catalogazione = bnc.id_norme_catalogazione">
   					
   					<field column="descrizione" name="norme_catalogazione" />   					
   			</entity>
   			
   			<entity name="accesso_modalita"
      				query="select am.descrizione from accesso_modalita as am,
      				biblioteca_has_accesso_modalita bam
      				where bam.id_biblioteca ='${biblioteca.id_biblioteca}' AND
      				am.id_accesso_modalita = bam.id_accesso_modalita">
      		
      				<field column="descrizione" name="accesso_modalita" />
   			</entity>  
   			 			
   			<entity name="contatti"
   					query="select concat(ct.descrizione, '$$$', c.valore, ';', IF(ASCII(c.note) = 0 or c.note is not null, concat('note:', c.note), '')) as recapito 
   					from contatti as c, contatti_tipo as ct 
   					where c.id_biblioteca ='${biblioteca.id_biblioteca}' and c.id_contatti_tipi=ct.id_contatti_tipo 
   					order by ct.descrizione, c.note ASC">
   					
   					<field column="recapito" name="contatti" />
   			</entity>   			
    		
    		<entity name="deposito_legale"
    				query="select concat(dt.descrizione, '$$$', IF(d.da_anno is not null, convert(d.da_anno using utf8), '')) as descr 
    				from depositi_legali d, depositi_legali_tipo dt 
    				where dt.id_depositi_legali_tipo=d.id_depositi_legali_tipo and d.id_biblioteca='${biblioteca.id_biblioteca}' 
    				order by d.id_biblioteca, dt.descrizione ASC">
    				
    				<field column="descr" name="deposito_legale" />
    		</entity>
    		
    		   
  	</entity>    
</document>
</dataConfig>